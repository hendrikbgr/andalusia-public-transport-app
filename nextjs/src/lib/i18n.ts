import { getCookie, setCookie } from './cookies';

export type Lang = 'en' | 'es';

export function getLang(): Lang {
  return (getCookie('lang') as Lang) || 'en';
}

export function setLang(lang: Lang): void {
  setCookie('lang', lang);
}

export interface DefaultRegion {
  idConsorcio: string | number;
  nombre: string;
}

export function getDefaultRegion(): DefaultRegion | null {
  const raw = getCookie('defaultRegion');
  try { return raw ? JSON.parse(raw) : null; } catch { return null; }
}

export function setDefaultRegion(consortium: DefaultRegion): void {
  setCookie('defaultRegion', JSON.stringify(consortium));
}

// ---- All translations ----
// Shared strings (ported from i18n.js TRANSLATIONS)
export const SHARED_STRINGS = {
  en: {
    appTitle: 'Bus Tracker',
    chooseRegion: 'Choose your region',
    searchPlaceholder: 'Search by stop name or townâ€¦',
    backBtn: 'â† Back',
    stopsHint: (n: number) => `${n} stops â€” start typing to search`,
    noStops: (q: string) => `No stops found for "${q}"`,
    noConnection: 'Could not load regions. Check your connection.',
    noStopsLoad: 'Could not load stops.',
    defaultRegionSet: (name: string) => `Default region set to ${name}`,
    setDefault: 'Set as default',
    defaultBadge: 'Default',
    liveLabel: 'Live',
    refreshIn: (s: number) => `Refresh in ${s}s`,
    scanQR: 'Scan for live departures',
    close: 'Close',
    noService: 'No services found today',
    checkBack: 'This stop has no more departures today',
    noServiceLoad: 'Could not load departures. Retryingâ€¦',
    scanningServices: 'Searching for upcoming servicesâ€¦',
    zone: (z: string) => `Zone ${z}`,
    now: 'Now',
    min: (m: number) => m === 1 ? '1 min' : `${m} min`,
    showOnMap: 'Show on map',
    saveStop: 'Save stop',
    unsaveStop: 'Saved â˜…',
    savedStops: 'Saved Stops',
    savedStopsEmpty: 'No saved stops yet',
    routeStops: 'Stops on this route',
    direction: 'Direction',
    outbound: 'Outbound',
    inbound: 'Inbound',
    tapStop: 'Tap a stop to see live departures',
    noRouteStops: 'Could not load route stops.',
    loadingRoute: 'Loading routeâ€¦',
    serviceAlerts: 'Service alerts',
    viewOnMap: 'View route on map',
    fullTimetable: 'Full timetable',
  },
  es: {
    appTitle: 'Rastreador de AutobÃºs',
    chooseRegion: 'Elige tu regiÃ³n',
    searchPlaceholder: 'Busca por nombre de parada o municipioâ€¦',
    backBtn: 'â† Volver',
    stopsHint: (n: number) => `${n} paradas â€” empieza a escribir`,
    noStops: (q: string) => `No se encontraron paradas para "${q}"`,
    noConnection: 'No se pudieron cargar las regiones. Comprueba la conexiÃ³n.',
    noStopsLoad: 'No se pudieron cargar las paradas.',
    defaultRegionSet: (name: string) => `RegiÃ³n predeterminada: ${name}`,
    setDefault: 'Predeterminar',
    defaultBadge: 'Predeter.',
    liveLabel: 'En vivo',
    refreshIn: (s: number) => `Actualizar en ${s}s`,
    scanQR: 'Escanea para ver salidas en vivo',
    close: 'Cerrar',
    noService: 'No hay servicios hoy',
    checkBack: 'Esta parada no tiene mÃ¡s salidas hoy',
    noServiceLoad: 'No se pudieron cargar las salidas. Reintentandoâ€¦',
    scanningServices: 'Buscando prÃ³ximos serviciosâ€¦',
    zone: (z: string) => `Zona ${z}`,
    now: 'Ahora',
    min: (m: number) => m === 1 ? '1 min' : `${m} min`,
    showOnMap: 'Ver en el mapa',
    saveStop: 'Guardar parada',
    unsaveStop: 'Guardada â˜…',
    savedStops: 'Paradas guardadas',
    savedStopsEmpty: 'No hay paradas guardadas',
    routeStops: 'Paradas de esta lÃ­nea',
    direction: 'DirecciÃ³n',
    outbound: 'Ida',
    inbound: 'Vuelta',
    tapStop: 'Toca una parada para ver salidas en vivo',
    noRouteStops: 'No se pudieron cargar las paradas de la lÃ­nea.',
    loadingRoute: 'Cargando lÃ­neaâ€¦',
    serviceAlerts: 'Alertas de servicio',
    viewOnMap: 'Ver ruta en el mapa',
    fullTimetable: 'Horario completo',
  },
} as const;

// Home page strings
export const HOME_STRINGS = {
  en: {
    pwaInstallMsg: 'Install for quick access',
    pwaInstall: 'Install',
    pwaDismiss: 'âœ• Not now',
    updateMsg: 'ğŸ‰ Update available',
    updateReload: 'Reload',
    updateDismiss: 'âœ•',
    greeting: () => {
      const h = new Date().getHours();
      if (h < 12) return 'Good morning';
      if (h < 18) return 'Good afternoon';
      return 'Good evening';
    },
    featTimetable: 'Live Departures',
    featTimetableDesc: 'See real-time buses at any stop',
    featLineTimetable: 'Line Timetables',
    featLineTimetableDesc: 'Search full schedules by line',
    featPlanner: 'Route Planner',
    featPlannerDesc: 'Find buses between two towns',
    featJourney: 'Journey Planner',
    featJourneyDesc: 'Find routes with transfers',
    featMap: 'Stop Map',
    featMapDesc: 'Browse all stops on a map',
    savedStopsLabel: 'Saved Stops',
    featuresLabel: 'Features',
  },
  es: {
    pwaInstallMsg: 'Instalar para acceso rÃ¡pido',
    pwaInstall: 'Instalar',
    pwaDismiss: 'âœ• Ahora no',
    updateMsg: 'ğŸ‰ ActualizaciÃ³n disponible',
    updateReload: 'Recargar',
    updateDismiss: 'âœ•',
    greeting: () => {
      const h = new Date().getHours();
      if (h < 12) return 'Buenos dÃ­as';
      if (h < 18) return 'Buenas tardes';
      return 'Buenas noches';
    },
    featTimetable: 'Salidas en Vivo',
    featTimetableDesc: 'Ver autobuses en tiempo real en cualquier parada',
    featLineTimetable: 'Horarios de LÃ­neas',
    featLineTimetableDesc: 'Busca horarios completos por lÃ­nea',
    featPlanner: 'Planificador de Ruta',
    featPlannerDesc: 'Encuentra autobuses entre dos localidades',
    featJourney: 'Planificador de Viaje',
    featJourneyDesc: 'Encuentra rutas con transbordos',
    featMap: 'Mapa de Paradas',
    featMapDesc: 'Explora todas las paradas en el mapa',
    savedStopsLabel: 'Paradas Guardadas',
    featuresLabel: 'Funciones',
  },
} as const;

// Planner strings
export const PLANNER_STRINGS = {
  en: {
    plannerTitle: 'Route Planner',
    labelRegion: 'Select region',
    labelFrom: 'From',
    labelTo: 'To',
    searchBtn: 'Search',
    searching: 'Searchingâ€¦',
    resultsLabel: (mode: string) => mode === 'today' ? 'Next departures' : mode === 'tomorrow' ? 'Departures tomorrow' : 'Departures on this date',
    noRoutes: 'No direct routes found',
    noRoutesHint: 'Try a different origin or destination',
    noConn: 'Could not load data. Check your connection.',
    backRegion: 'â† Back',
    backForm: 'â† Change route',
    placeholder: 'Type a town or stopâ€¦',
    todayLabel: 'Today',
    schedLabel: (s: string) => `Departs ${s}`,
    minsLabel: (m: number) => m <= 0 ? 'Now' : m === 1 ? 'in 1 min' : `in ${m} min`,
    passesThrough: 'via',
    dateToday: 'Today',
    dateTomorrow: 'Tomorrow',
    datePick: 'Pick date',
    directConnections: (mode: string) => mode === 'today' ? 'All departures today:' : mode === 'tomorrow' ? 'All departures tomorrow:' : 'All departures on this date:',
    changeRegion: 'Change region',
  },
  es: {
    plannerTitle: 'Planificador de Ruta',
    labelRegion: 'Selecciona regiÃ³n',
    labelFrom: 'Desde',
    labelTo: 'Hasta',
    searchBtn: 'Buscar',
    searching: 'Buscandoâ€¦',
    resultsLabel: (mode: string) => mode === 'today' ? 'PrÃ³ximas salidas' : mode === 'tomorrow' ? 'Salidas maÃ±ana' : 'Salidas en esta fecha',
    noRoutes: 'No se encontraron rutas directas',
    noRoutesHint: 'Prueba con otro origen o destino',
    noConn: 'No se pudo cargar. Comprueba la conexiÃ³n.',
    backRegion: 'â† Volver',
    backForm: 'â† Cambiar ruta',
    placeholder: 'Escribe una localidad o paradaâ€¦',
    todayLabel: 'Hoy',
    schedLabel: (s: string) => `Sale ${s}`,
    minsLabel: (m: number) => m <= 0 ? 'Ahora' : m === 1 ? 'en 1 min' : `en ${m} min`,
    passesThrough: 'vÃ­a',
    dateToday: 'Hoy',
    dateTomorrow: 'MaÃ±ana',
    datePick: 'Elegir fecha',
    directConnections: (mode: string) => mode === 'today' ? 'Todas las salidas hoy:' : mode === 'tomorrow' ? 'Todas las salidas maÃ±ana:' : 'Todas las salidas en esta fecha:',
    changeRegion: 'Cambiar regiÃ³n',
  },
} as const;

// Journey planner strings
export const JOURNEY_STRINGS = {
  en: {
    journeyTitle: 'Journey Planner',
    labelRegion: 'Select region',
    labelFrom: 'From',
    labelTo: 'To',
    searchBtn: 'Search',
    searching: 'Searching for connectionsâ€¦',
    resultsLabel: (mode: string) => mode === 'today' ? 'Journeys today' : mode === 'tomorrow' ? 'Journeys tomorrow' : 'Journeys on this date',
    noRoutes: 'No routes found',
    noRoutesHint: 'Try a different origin or destination',
    noConn: 'Could not load data. Check your connection.',
    backRegion: 'â† Back',
    backForm: 'â† Change route',
    placeholder: 'Type a town or stopâ€¦',
    outOfNetworkItem: (name: string) => `Search lines to "${name}" â†’`,
    changeRegion: 'Change region',
    dateToday: 'Today',
    dateTomorrow: 'Tomorrow',
    datePick: 'Pick date',
    direct: 'DIRECT',
    leg1Label: 'Leg 1',
    leg2Label: 'Leg 2',
    transfer: 'Transfer at',
    transferWait: (mins: number) => `~${mins} min wait`,
    minsLabel: (m: number) => m <= 0 ? 'Now' : m === 1 ? 'in 1 min' : `in ${m} min`,
    passesThrough: 'via',
    linesHeading: 'Lines serving this destination:',
    stepBoard: 'Board',
    stepTransfer: 'Transfer',
    stepArrive: 'Arrive',
    stepWait: (mins: number) => `~${mins} min wait`,
    viewOnMap: 'ğŸ“ View on map',
    oonLineLabel: 'Line',
    oonHint: (from: string) => `This line does not directly serve ${from}. You will need to reach a stop on this route first.`,
  },
  es: {
    journeyTitle: 'Planificador de Viaje',
    labelRegion: 'Selecciona regiÃ³n',
    labelFrom: 'Desde',
    labelTo: 'Hasta',
    searchBtn: 'Buscar',
    searching: 'Buscando conexionesâ€¦',
    resultsLabel: (mode: string) => mode === 'today' ? 'Viajes hoy' : mode === 'tomorrow' ? 'Viajes maÃ±ana' : 'Viajes en esta fecha',
    noRoutes: 'No se encontraron rutas',
    noRoutesHint: 'Prueba con otro origen o destino',
    noConn: 'No se pudo cargar. Comprueba la conexiÃ³n.',
    backRegion: 'â† Volver',
    backForm: 'â† Cambiar ruta',
    placeholder: 'Escribe una localidad o paradaâ€¦',
    outOfNetworkItem: (name: string) => `Buscar lÃ­neas hacia "${name}" â†’`,
    changeRegion: 'Cambiar regiÃ³n',
    dateToday: 'Hoy',
    dateTomorrow: 'MaÃ±ana',
    datePick: 'Elegir fecha',
    direct: 'DIRECTO',
    leg1Label: 'Tramo 1',
    leg2Label: 'Tramo 2',
    transfer: 'Transbordo en',
    transferWait: (mins: number) => `~${mins} min espera`,
    minsLabel: (m: number) => m <= 0 ? 'Ahora' : m === 1 ? 'en 1 min' : `en ${m} min`,
    passesThrough: 'vÃ­a',
    linesHeading: 'LÃ­neas que sirven este destino:',
    stepBoard: 'Embarcar',
    stepTransfer: 'Transbordo',
    stepArrive: 'Llegada',
    stepWait: (mins: number) => `~${mins} min espera`,
    viewOnMap: 'ğŸ“ Ver en el mapa',
    oonLineLabel: 'LÃ­nea',
    oonHint: (from: string) => `Esta lÃ­nea no sirve directamente ${from}. TendrÃ¡ que llegar a una parada en esta ruta primero.`,
  },
} as const;

// Line timetable strings
export const LTT_STRINGS = {
  en: {
    title: 'Line Timetables',
    regionLabel: 'Select region',
    backRegion: 'â† Back',
    backSearch: 'â† Back',
    searchHint: 'Type a line code (e.g. M-221) or part of the name',
    searchPlaceholder: 'Search by line number or nameâ€¦',
    noLines: 'No lines found',
    noConn: 'Could not load data. Check your connection.',
    loading: 'Loadingâ€¦',
    outbound: 'Outbound',
    inbound: 'Inbound',
    noData: 'No timetable data available',
    stop: 'Stop',
    changeRegion: 'Change region',
  },
  es: {
    title: 'Horarios de LÃ­neas',
    regionLabel: 'Selecciona regiÃ³n',
    backRegion: 'â† Volver',
    backSearch: 'â† Volver',
    searchHint: 'Escribe el cÃ³digo (p.ej. M-221) o parte del nombre',
    searchPlaceholder: 'Busca por nÃºmero de lÃ­nea o nombreâ€¦',
    noLines: 'No se encontraron lÃ­neas',
    noConn: 'No se pudo cargar. Comprueba la conexiÃ³n.',
    loading: 'Cargandoâ€¦',
    outbound: 'Ida',
    inbound: 'Vuelta',
    noData: 'No hay datos de horario disponibles',
    stop: 'Parada',
    changeRegion: 'Cambiar regiÃ³n',
  },
} as const;

// Settings strings
export const SETTINGS_STRINGS = {
  en: {
    title: 'Settings',
    langLabel: 'Language',
    langTitle: 'App language',
    langDesc: 'Choose display language',
    plannerLabel: 'Route Planner',
    dateModeTitle: 'Default date',
    dateModeDesc: 'Which day to search by default',
    segToday: 'Today',
    segTomorrow: 'Tomorrow',
    regionLabel: 'Default Region',
    regionTitle: 'Default region',
    regionDesc: 'Skip the region picker and go straight to stop search',
    regionNone: 'None set',
    regionClear: 'Clear',
    stopsLabel: 'Saved Stops',
    stopsEmpty: 'No saved stops',
    stopsRemove: 'âœ•',
    clearStops: 'Clear all saved stops',
    aboutLabel: 'About',
    aboutDesc: 'Data from api.ctan.es Â· 9 Andalusia consortiums',
    cacheTitle: 'Clear app cache',
    cacheDesc: 'Forces latest files to reload',
    cacheClear: 'Clear',
    toastLangSaved: (l: string) => `Language set to ${l === 'en' ? 'English' : 'EspaÃ±ol'}`,
    toastDateSaved: (m: string) => `Default date: ${m === 'today' ? 'Today' : 'Tomorrow'}`,
    toastRegionCleared: 'Default region cleared',
    toastStopsCleared: 'All saved stops cleared',
    toastCacheCleared: 'Cache cleared â€” reload to apply',
    installLabel: 'App',
    installTitle: 'Add to Home Screen',
    installDesc: 'Install the app for quick access',
    installBtnView: 'View',
    installGuideTitle: 'Add to Home Screen',
    installIosIntro: 'Follow these steps in Safari:',
    installIosStep1: 'Open this page in Safari (not Chrome)',
    installIosStep2: 'Tap the Share button (â–¡â†‘) at the bottom of the screen',
    installIosStep3: 'Scroll down and tap "Add to Home Screen"',
    installIosStep4: 'Tap "Add" in the top-right corner to confirm',
    installIosNote: 'â“˜ Chrome on iOS cannot install apps. You must use Safari.',
    installAndroidIntro: 'Follow these steps in Chrome:',
    installAndroidStep1: 'Tap the menu (â‹®) in the top-right corner',
    installAndroidStep2: 'Tap "Add to Home screen"',
    installAndroidStep3: 'Tap "Add" to confirm',
    installOtherIntro: 'On desktop, look for the install icon (âŠ•) in your browser\'s address bar, or open the browser menu and choose "Install app".',
    ossLabel: 'Open Source',
    ossTitle: 'CTAN Bus Tracker',
    ossDesc: 'Free and open source â€” built for the community',
    ossText: 'This app is free, open source, and has no ads or tracking. It was built to make Andalusia\'s public transport more accessible to everyone â€” locals and visitors alike.',
    githubTitle: 'View on GitHub',
    githubDesc: 'Star the repo, report issues, or contribute',
    savedToast: (name: string) => `Default region: ${name}`,
  },
  es: {
    title: 'Ajustes',
    langLabel: 'Idioma',
    langTitle: 'Idioma de la app',
    langDesc: 'Elige el idioma de visualizaciÃ³n',
    plannerLabel: 'Planificador de Ruta',
    dateModeTitle: 'Fecha por defecto',
    dateModeDesc: 'QuÃ© dÃ­a buscar por defecto',
    segToday: 'Hoy',
    segTomorrow: 'MaÃ±ana',
    regionLabel: 'RegiÃ³n Predeterminada',
    regionTitle: 'RegiÃ³n predeterminada',
    regionDesc: 'Salta el selector de regiÃ³n e ir directamente a la bÃºsqueda',
    regionNone: 'Sin definir',
    regionClear: 'Borrar',
    stopsLabel: 'Paradas Guardadas',
    stopsEmpty: 'No hay paradas guardadas',
    stopsRemove: 'âœ•',
    clearStops: 'Eliminar todas las paradas guardadas',
    aboutLabel: 'Acerca de',
    aboutDesc: 'Datos de api.ctan.es Â· 9 consorcios de AndalucÃ­a',
    cacheTitle: 'Vaciar cachÃ©',
    cacheDesc: 'Fuerza la recarga de los Ãºltimos archivos',
    cacheClear: 'Vaciar',
    toastLangSaved: (l: string) => `Idioma: ${l === 'en' ? 'English' : 'EspaÃ±ol'}`,
    toastDateSaved: (m: string) => `Fecha por defecto: ${m === 'today' ? 'Hoy' : 'MaÃ±ana'}`,
    toastRegionCleared: 'RegiÃ³n predeterminada eliminada',
    toastStopsCleared: 'Todas las paradas guardadas eliminadas',
    toastCacheCleared: 'CachÃ© vaciada â€” recarga para aplicar',
    installLabel: 'App',
    installTitle: 'AÃ±adir a pantalla de inicio',
    installDesc: 'Instala la app para acceso rÃ¡pido',
    installBtnView: 'Ver',
    installGuideTitle: 'AÃ±adir a pantalla de inicio',
    installIosIntro: 'Sigue estos pasos en Safari:',
    installIosStep1: 'Abre esta pÃ¡gina en Safari (no en Chrome)',
    installIosStep2: 'Pulsa el botÃ³n Compartir (â–¡â†‘) en la parte inferior de la pantalla',
    installIosStep3: 'DesplÃ¡zate hacia abajo y pulsa "AÃ±adir a pantalla de inicio"',
    installIosStep4: 'Pulsa "AÃ±adir" en la esquina superior derecha para confirmar',
    installIosNote: 'â“˜ Chrome en iOS no puede instalar apps. Debes usar Safari.',
    installAndroidIntro: 'Sigue estos pasos en Chrome:',
    installAndroidStep1: 'Pulsa el menÃº (â‹®) en la esquina superior derecha',
    installAndroidStep2: 'Pulsa "AÃ±adir a pantalla de inicio"',
    installAndroidStep3: 'Pulsa "AÃ±adir" para confirmar',
    installOtherIntro: 'En escritorio, busca el icono de instalaciÃ³n (âŠ•) en la barra de direcciones del navegador, o abre el menÃº del navegador y elige "Instalar app".',
    ossLabel: 'CÃ³digo Abierto',
    ossTitle: 'CTAN Bus Tracker',
    ossDesc: 'Gratuita y de cÃ³digo abierto â€” hecha para la comunidad',
    ossText: 'Esta app es gratuita, de cÃ³digo abierto y no tiene anuncios ni rastreo. Fue creada para hacer el transporte pÃºblico de AndalucÃ­a mÃ¡s accesible para todos â€” locales y visitantes.',
    githubTitle: 'Ver en GitHub',
    githubDesc: 'Dale una estrella, reporta problemas o contribuye',
    savedToast: (name: string) => `RegiÃ³n predeterminada: ${name}`,
  },
} as const;
